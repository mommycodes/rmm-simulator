import streamlit as st
import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
from simulator import run_simulation
from visualizations import plot_simulations, plot_best_worst, plot_distribution, plot_liquidation_distribution, plot_probability_heatmap

st.set_page_config(layout="wide")
st.title("๐ฏ ะขะพัะณะพะฒัะน ัะธะผัะปััะพั ัััะฐัะตะณะธะธ")

# === ะะฒะพะด ะฟะฐัะฐะผะตััะพะฒ ===
with st.sidebar:
    st.header("โ๏ธ ะัะพะดะฝัะต ะฟะฐัะฐะผะตััั")
    initial_balance = st.number_input("๐ฐ ะะฐัะฐะปัะฝัะน ะฑะฐะปะฐะฝั ($)", value=100.0, min_value=1.0, help="ะกัะผะผะฐ, ั ะบะพัะพัะพะน ะฝะฐัะธะฝะฐะตััั ะบะฐะถะดะฐั ัะธะผัะปััะธั")
    num_trades = st.number_input("๐ ะะพะป-ะฒะพ ัะดะตะปะพะบ", value=50, min_value=1, max_value=1000, help="ะกะบะพะปัะบะพ ะฟะพะดััะด ัะดะตะปะพะบ ะฑัะดะตั ัะพะฒะตััะตะฝะพ ะฒ ะพะดะฝะพะน ัะธะผัะปััะธะธ")
    risk_mode = st.radio("๐ ะัะฑะตัะธัะต ะผะตัะพะด ัะฐััััะฐ ัะธัะบะฐ:", ["ะะธัะบ ะฝะฐ ัะดะตะปะบั (%)", "ะะธัะบ ะฝะฐ ะดะตะฝั (%)"], index=0)
    if risk_mode == "ะะธัะบ ะฝะฐ ัะดะตะปะบั (%)":
        risk_pct = st.number_input("๐ฅ ะะธัะบ ะฝะฐ ัะดะตะปะบั (%)", value=2.0, min_value=0.1, max_value=100.0,
                                help="ะัะพัะตะฝั ะบะฐะฟะธัะฐะปะฐ, ะบะพัะพััะผ ะฒั ัะธัะบัะตัะต ะฒ ะบะฐะถะดะพะน ัะดะตะปะบะต")
        risk_dollars = initial_balance * risk_pct / 100
        st.caption(f"โ๏ธ ะะธัะบ ะฝะฐ ัะดะตะปะบั: **{risk_pct:.2f}%** โ ${risk_dollars:.2f}")
    else:
        day_risk_pct = st.number_input("๐ ะะธัะบ ะฝะฐ ะดะตะฝั (%)", value=2.0, min_value=0.1, max_value=100.0,
                                    help="ะกะบะพะปัะบะพ ะฟัะพัะตะฝัะพะฒ ะบะฐะฟะธัะฐะปะฐ ะฒั ะณะพัะพะฒั ะฟะพัะตัััั ะทะฐ ะดะตะฝั")
        risk_pct = day_risk_pct / num_trades
        risk_dollars = initial_balance * risk_pct / 100
        st.caption(f"โ๏ธ ะะธัะบ ะฝะฐ ัะดะตะปะบั: **{risk_pct:.2f}%** โ ${risk_dollars:.2f} ะธะท {day_risk_pct:.1f}% ะฝะฐ ะดะตะฝั")
    stop_pct = st.number_input("๐ ะกัะพะฟ-ะปะพัั (%)", value=1.0, min_value=0.1, max_value=100.0, help="ะัะพัะตะฝั ะพั ะฟะธะบะพะฒะพะณะพ ะฑะฐะปะฐะฝัะฐ, ะฟัะธ ะบะพัะพัะพะผ ัะดะตะปะบะฐ ะทะฐะบััะฒะฐะตััั ะฒ ัะฑััะพะบ")
    rr = st.number_input("โ๏ธ Reward/Risk (RR)", value=2.0, min_value=0.1, help="ะกะพะพัะฝะพัะตะฝะธะต ะฟัะธะฑัะปะธ ะบ ัะฑััะบั. RR = 2 ะพะทะฝะฐัะฐะตั, ััะพ ะฟัะธ ััะพะฟะต 1% ะฒั ะฑะตัััะต ะฟัะพัะธั 2%.")
    if stop_pct > 0:
        tp_pct = stop_pct * rr
        st.caption(f"๐ ะขะตะบััะธะน RR: **{rr:.1f}:1** โ ััะพะฟ: {stop_pct:.1f}%, ะฟัะพัะธั: {tp_pct:.1f}%")
    else:
        st.caption("๐ ะขะตะบััะธะน RR: **{rr:.1f}:1** โ ะพะถะธะดะฐะตััั ะฝะตะฝัะปะตะฒะพะน ััะพะฟ ะดะปั ะฒััะธัะปะตะฝะธั ะฟัะพัะธัะฐ.")
    winrate = st.slider("๐ฏ Winrate (%)", min_value=0, max_value=100, value=50, help="ะะฐะบ ัะฐััะพ ัััะฐัะตะณะธั ะฟัะธะฝะพัะธั ะฟัะธะฑัะปั. ะะฐะฟัะธะผะตั, 60% ะพะทะฝะฐัะฐะตั 6 ะธะท 10 ัะดะตะปะพะบ โ ะฟัะธะฑัะปัะฝัะต")
    simulations = st.number_input("๐ ะะพะป-ะฒะพ ัะธะผัะปััะธะน", value=100, min_value=1, max_value=10000, help="ะกะบะพะปัะบะพ ัะฐะทะฝัั ััะฐะตะบัะพัะธะน ะบะฐะฟะธัะฐะปะฐ ะฑัะดะตั ัะผะพะดะตะปะธัะพะฒะฐะฝะพ")
    liquidation_pct = st.number_input("๐ ะะพัะพะณ ะปะธะบะฒะธะดะฐัะธะธ (%)", value=1.0, min_value=0.0, max_value=100.0, help="ะัะปะธ ะฑะฐะปะฐะฝั ะฟะฐะดะฐะตั ะฝะธะถะต ััะพะณะพ ะฟัะพัะตะฝัะฐ ะพั ะฝะฐัะฐะปัะฝะพะณะพ โ ััะธัะฐะตััั, ััะพ ะฟัะพะธะทะพัะปะฐ ะปะธะบะฒะธะดะฐัะธั")

# === ะะปะณะพัะธัะผ ะะฐะฝะธะผะตะฝะตะดะถะผะตะฝัะฐ ===
with st.container():
    st.markdown("### ๐ ะะปะณะพัะธัะผ ะผะฐะฝะธะผะตะฝะตะดะถะผะตะฝัะฐ")
    st.markdown("""
1. โ **ะกัะพะฟ-ัะพัะณะธ** ะฟะพัะปะต **3 ัะฑััะพัะฝัั ัะดะตะปะพะบ**
2. โ๏ธ **RR ะผะธะฝะธะผัะผ 3:1** โ ะบะฐะถะดะฐั ะฟัะธะฑัะปั ะผะธะฝะธะผัะผ ะฒ 3 ัะฐะทะฐ ะฑะพะปััะต ัะฑััะบะฐ
3. ๐ **ะขะพัะณะพะฒัะน ะฟะปะฐะฝ ะฝะฐ ะดะตะฝั** (ะฟะพ ัะตะบ-ะปะธััั)
4. ๐ **ะะตะดะตะฝะธะต ะดะฝะตะฒะฝะธะบะฐ ัะดะตะปะพะบ** ะธ ััะฐัะธััะธะบะธ
5. ๐ต **ะะดะธะฝ ะธ ัะพั ะถะต ัะธัะบ ะฒ $** ะฝะฐ ัะดะตะปะบั (**2%**)
6. ๐ **ะะต ะฟัะตะฒััะฐัั ะพะฑััะผ** โ ัะธัะบะพะฒะฐัั ัะพะปัะบะพ ะผะฐะปะพะน ัะฐัััั ะดะตะฟะพะทะธัะฐ
7. ๐งฏ **ะะตัะตััะฒ 2โ3 ะฝะตะดะตะปะธ** ะฟัะธ ะฟัะพัะฐะดะบะต > **20% ะทะฐ ะผะตััั**
8. โ **ะะฐะบัััะธะต ะดะฝั** ะฟัะธ ะฟัะธะฑัะปะธ **2โ5%**

> ๐ฏ **ะฆะตะปั**: ะฝะต ะฟะพัะตัััั ะดะตะฟะพะทะธั, ะพััะฐัััั ะฝะฐ ััะฝะบะต

### ๐ ะะธะฝะธะผะฐะปัะฝะพ ะถะธะทะฝะตัะฟะพัะพะฑะฝะฐั ัััะฐัะตะณะธั:
- **RR โฅ 3:1**
- **Winrate โฅ 35%**

๐ง ะะฐะถะต ะฟัะธ **65% ัะฑััะพัะฝัั ัะดะตะปะบะฐั** ะผะพะถะฝะพ ะฒัะถะธัั, ะตัะปะธ ัะพะฑะปัะดะฐัั ัะพะพัะฝะพัะตะฝะธะต ัะธัะบะฐ ะธ ะฟัะธะฑัะปะธ!
""")
    
# === ะะฐะปัะบัะปััะพั ะฒัะพะดะฐ ===
st.markdown("---")
st.markdown("### ๐ ะะฐะปัะบัะปััะพั ะฒัะพะดะฐ")
st.info("โ๏ธ ะญัะพั ะฑะปะพะบ ะฝะต ะฒะปะธัะตั ะฝะฐ ัะธะผัะปััะธั โ ะธัะฟะพะปัะทัะตััั ัะพะปัะบะพ ะดะปั ัะฐััััะฐ ะฒัััะฝัั")

with st.expander("๐ ะะพะบะฐะทะฐัั ะบะฐะปัะบัะปััะพั"):
    calc_deposit = st.number_input("๐ผ ะะตะฟะพะทะธั ($)", value=100.0, key="calc_dep")
    calc_risk_pct = st.number_input("๐ ะะธัะบ ะฝะฐ ะดะตะฝั (%)", value=2.0, key="calc_risk")
    calc_num_trades = st.number_input("๐ข ะกะดะตะปะพะบ ะฒ ะดะตะฝั", value=3, key="calc_trades")
    calc_stop_pct = st.number_input("๐ ะกัะพะฟ (%)", value=1.0, key="calc_stop")

    risk_per_trade = (calc_deposit * calc_risk_pct / 100) / calc_num_trades if calc_num_trades else 0
    position_size = risk_per_trade / (calc_stop_pct / 100) if calc_stop_pct else 0

    st.markdown(f"**โ๏ธ ะะธัะบ ะฝะฐ ัะดะตะปะบั:** ${risk_per_trade:.2f}")
    st.markdown(f"**๐ฏ ะะฑััะผ ะฒัะพะดะฐ:** ${position_size:.2f}")

st.markdown("---")
st.markdown("<h3 style='text-align: center;'>๐ <b>ะะฐัะฐัั ัะธะผัะปััะธั</b></h3>", unsafe_allow_html=True)
start = st.button("โถ๏ธ ะกัะฐัั", use_container_width=True)

if start:
    data, balances, liq_hits, liq_steps, drawdowns, all_trades = run_simulation(
        initial_balance, num_trades, risk_pct, rr, winrate, simulations, liquidation_pct, stop_pct)
    st.subheader("๐ ะะตะทัะปััะฐัั ัะธะผัะปััะธะธ")
    data, balances, liq_hits, liq_steps, drawdowns = run_simulation(
        initial_balance, num_trades, risk_pct, rr, winrate, simulations, liquidation_pct
    )
    st.session_state.sim_data = data
    st.session_state.balances = balances
    st.session_state.liq_hits = liq_hits
    st.session_state.liq_steps = liq_steps
    st.session_state.drawdowns = drawdowns
    st.session_state.all_trades = all_trades

if "sim_data" in st.session_state:
    data = st.session_state.sim_data
    balances = st.session_state.balances
    liq_hits = st.session_state.liq_hits
    liq_steps = st.session_state.liq_steps
    drawdowns = st.session_state.drawdowns
    all_trades = st.session_state.all_trades

    st.subheader("๐ ะะตะทัะปััะฐัั ัะธะผัะปััะธะธ")

    # === ะะตััะธะบะธ
    st.markdown("### ๐ ะะฑัะฐั ััะฐัะธััะธะบะฐ")
    with st.container():
        col1, col2, col3 = st.columns(3)
        col1.metric("๐ ะะตะดะธะฐะฝะฝะพะต ะทะฝะฐัะตะฝะธะต", f"{np.median(balances):,.2f}", help="ะะตะดะธะฐะฝะฝะพะต ะทะฝะฐัะตะฝะธะต ะธัะพะณะพะฒะพะณะพ ะฑะฐะปะฐะฝัะฐ: ั ะฟะพะปะพะฒะธะฝั ัะธะผัะปััะธะน ัะตะทัะปััะฐั ะฒััะต, ั ะฟะพะปะพะฒะธะฝั โ ะฝะธะถะต. ะัะถะฝะฐ, ััะพะฑั ัะฒะธะดะตัั, ะบะฐะบะพะน ัะตะทัะปััะฐั ะดะฐัั ัััะฐัะตะณะธั ะฒ ัะธะฟะธัะฝะพะผ ััะตะฝะฐัะธะธ ะฑะตะท ะฒะปะธัะฝะธั ัะบัััะตะผัะผะพะฒ.")

        col1.metric("๐ ะกัะตะดะฝะธะน ะธัะพะณ", f"{np.mean(balances):,.2f}", help="ะัะธัะผะตัะธัะตัะบะพะต ััะตะดะฝะตะต ะฒัะตั ัะธะฝะฐะปัะฝัั ะฑะฐะปะฐะฝัะพะฒ. ะัะฟะพะปัะทัะตััั ะดะปั ะพัะตะฝะบะธ ะพะฑัะตะน ัััะตะบัะธะฒะฝะพััะธ ัััะฐัะตะณะธะธ, ะฝะพ ััะฒััะฒะธัะตะปัะฝะพ ะบ ะฒัะฑัะพัะฐะผ.")

        col2.metric("๐ป ะะธะฝะธะผะฐะปัะฝัะน ัะตะทัะปััะฐั", f"{np.min(balances):,.2f}", help="ะะฐะธััะดัะธะน ัะตะทัะปััะฐั ััะตะดะธ ะฒัะตั ัะธะผัะปััะธะน. ะะพะผะพะณะฐะตั ะพัะตะฝะธัั ะฟะพัะตะฝัะธะฐะปัะฝัะต ัะธัะบะธ ะธ ะฟัะพัะฐะดะบะธ ะฟัะธ ะฝะตะฑะปะฐะณะพะฟัะธััะฝัั ััะปะพะฒะธัั.")

        col2.metric("๐ข ะะฐะบัะธะผะฐะปัะฝัะน ัะตะทัะปััะฐั", f"{np.max(balances):,.2f}", help="ะะฐะธะปัััะธะน ัะตะทัะปััะฐั. ะะพะทะฒะพะปัะตั ัะฒะธะดะตัั ะฟะพัะตะฝัะธะฐะป ัััะฐัะตะณะธะธ ะฒ ะธะดะตะฐะปัะฝัั ััะปะพะฒะธัั, ะฝะพ ะฝะต ะณะฐัะฐะฝัะธััะตั ะฟะพะฒัะพััะตะผะพััะธ.")

        col3.metric("๐ฒ ะะพะปะฐัะธะปัะฝะพััั (Std Dev)", f"{np.std(balances):,.2f}", help="ะกัะฐะฝะดะฐััะฝะพะต ะพัะบะปะพะฝะตะฝะธะต ะพั ััะตะดะฝะตะณะพ. ะงะตะผ ะฒััะต โ ัะตะผ ะผะตะฝะตะต ะฟัะตะดัะบะฐะทัะตะผะฐั ัััะฐัะตะณะธั. ะญัะพ ะฒะฐะถะฝัะน ะฟะพะบะฐะทะฐัะตะปั ััะฐะฑะธะปัะฝะพััะธ.")

        col3.metric("๐ ะะพะป-ะฒะพ ัะธะผัะปััะธะน", str(len(balances)), help="ะะฑัะตะต ัะธัะปะพ ะฝะตะทะฐะฒะธัะธะผัั ัะธะผัะปััะธะน ัััะฐัะตะณะธะธ. ะงะตะผ ะธั ะฑะพะปััะต โ ัะตะผ ะฝะฐะดัะถะฝะตะต ััะฐัะธััะธะบะฐ.")

    st.metric("๐ ะะธะบะฒะธะดะฐัะธะธ", f"{liq_hits} ะธะท {len(balances)} ({liq_hits / len(balances) * 100:.1f}%)", help="ะกะธะผัะปััะธะธ, ะฒ ะบะพัะพััั ะบะฐะฟะธัะฐะป ะพะฟัััะธะปัั ะฝะธะถะต ัััะฐะฝะพะฒะปะตะฝะฝะพะณะพ ะฟะพัะพะณะฐ ะปะธะบะฒะธะดะฐัะธะธ. ะะฐะถะฝะพ ะดะปั ะพัะตะฝะบะธ ัะธัะบะฐ ะฟะพะปะฝะพะณะพ ะพะฑะฝัะปะตะฝะธั ะดะตะฟะพะทะธัะฐ.")

     # === ะะพะฟะพะปะฝะธัะตะปัะฝะพ
    st.markdown("### ๐งช ะะพะฟ. ะฟะพะบะฐะทะฐัะตะปะธ")

    st.write(f"๐ ะกัะตะดะฝัั ะฟัะพัะฐะดะบะฐ: **{np.mean(drawdowns) * 100:.2f}%**")
    st.caption("ะะพะบะฐะทัะฒะฐะตั, ัะบะพะปัะบะพ ะฒ ััะตะดะฝะตะผ ัะตััะปะพัั ะพั ะฟะธะบะพะฒะพะณะพ ะฑะฐะปะฐะฝัะฐ ะดะพ ะปะพะบะฐะปัะฝะพะณะพ ะผะธะฝะธะผัะผะฐ. ะะพะผะพะณะฐะตั ะพัะตะฝะธัั ััะพะฒะตะฝั ะดะธัะบะพะผัะพััะฐ, ะบะพัะพััะน ะฟัะธะดัััั ะฟะตัะตะถะธะฒะฐัั.")

    st.write(f"๐ต ะัะพะณ > ััะฐััะพะฒะพะณะพ ะบะฐะฟะธัะฐะปะฐ: **{np.sum(balances > initial_balance)} ({np.mean(balances > initial_balance) * 100:.1f}%)**")
    st.caption("ะกะบะพะปัะบะพ ัะธะผัะปััะธะน ะทะฐะฒะตััะธะปะธัั ะฒ ะฟะปััะต. ะะพะปะตะทะฝะพ ะดะปั ะพัะตะฝะบะธ ะฒะตัะพััะฝะพััะธ ัะพัั ะฑั ัะผะตัะตะฝะฝะพะณะพ ััะฟะตัะฐ.")

    st.write(f"๐ฐ ะัะพะณ > 2ร ะบะฐะฟะธัะฐะปะฐ: **{np.sum(balances > initial_balance * 2)} ({np.mean(balances > initial_balance * 2) * 100:.1f}%)**")
    st.caption("ะกะธะผัะปััะธะธ ั ัะดะฒะพะตะฝะธะตะผ ะบะฐะฟะธัะฐะปะฐ ะธ ะฑะพะปะตะต. ะะพะบะฐะทัะฒะฐะตั, ะฝะฐัะบะพะปัะบะพ ะฒะตะปะธะบะฐ ะฒะตัะพััะฝะพััั ัััะตััะฒะตะฝะฝะพะณะพ ัะพััะฐ ะดะตะฟะพะทะธัะฐ.")

    st.write(f"๐ ะัะพะณ > 10ร ะบะฐะฟะธัะฐะปะฐ: **{np.sum(balances > initial_balance * 10)} ({np.mean(balances > initial_balance * 10) * 100:.1f}%)**")
    st.caption("ะะตะดะบะธะต, ะฝะพ ะฒะดะพัะฝะพะฒะปัััะธะต ัะปััะฐะธ. ะะพะผะพะณะฐะตั ัะฒะธะดะตัั ะดะพะปะณะพััะพัะฝัะน ะฟะพัะตะฝัะธะฐะป ัััะฐัะตะณะธะธ ะฟัะธ ะธะดะตะฐะปัะฝัั ััะปะพะฒะธัั.")

    # === ะกัะฐััั ัััะฐัะตะณะธะธ
    if np.median(balances) > initial_balance:
        st.success("โ ะกััะฐัะตะณะธั ะฟัะธะฑัะปัะฝะฐั")
    else:
        st.error("โ ะกััะฐัะตะณะธั ัะฑััะพัะฝะฐั")

    # === ะะพัะพะณ ะฑะตะทัะฑััะพัะฝะพััะธ
    min_wr = 100 / (1 + rr)
    st.info(f"๐ฏ ะะธะฝะธะผะฐะปัะฝัะน Winrate ะดะปั ะฑะตะทัะฑััะบะฐ: **{min_wr:.2f}%**")
    st.caption("ะะธะฝะธะผะฐะปัะฝัะน ะฟัะพัะตะฝั ะฟะพะฑะตะด, ะฟัะธ ะบะพัะพัะพะผ ัััะฐัะตะณะธั ัะพัั ะฑั ะฝะต ัะตััะตั ะดะตะฝัะณะธ. ะัะฟะพะปัะทัะตััั ะดะปั ะพัะตะฝะบะธ ะถะธะทะฝะตัะฟะพัะพะฑะฝะพััะธ.")

    # === ะัะฐัะธะบะธ ===
    plot_simulations(data, initial_balance)
    plot_best_worst(data, balances)
    plot_distribution(balances, initial_balance)
    plot_probability_heatmap(data, initial_balance)
    if liq_steps:
        plot_liquidation_distribution(liq_steps, num_trades)

    # === ะัะฒะพะด ัะธะผัะปััะธะธ ะดะปั ัะฐะทะฑะพัะฐ
    st.markdown("### ๐ ะะตัะฐะปัะฝัะน ัะฐะทะฑะพั ัะธะผัะปััะธะธ")
    st.info("""
    ๐ *ะะดะตัั ะฒั ะผะพะถะตัะต ะฟัะพะฐะฝะฐะปะธะทะธัะพะฒะฐัั ะปัะฑัั ัะธะผัะปััะธั ะฟะพ ัะฐะณะฐะผ:*  
    ะบะฐะถะดัะน ะฟะฐัะฐะผะตัั: **PnL**, ๐ *ะฟัะพัะฐะดะบะฐ*, ๐ *ะดะธะฝะฐะผะธะบะฐ ะบะฐะฟะธัะฐะปะฐ* โ ะฟะตัะตะด ะฒะฐะผะธ!

    **ะัะฑะตัะธัะต** ะธะฝัะตัะตัััััั ัะธะผัะปััะธั ะธะท ะฒัะฟะฐะดะฐััะตะณะพ ัะฟะธัะบะฐ ะฝะธะถะต โฌ๏ธ
    """)

    # ะะฝะดะตะบัั ะปัััะตะน ะธ ััะดัะตะน
    best_idx = np.argmax(balances)
    worst_idx = np.argmin(balances)

    # ะกะฟะธัะพะบ ะดะปั ะฒัะฑะพัะฐ
    options = {
        f"๐ฅ ะัััะฐั ัะธะผัะปััะธั โ {balances[best_idx]:,.2f}": best_idx,
        f"๐ง ะฅัะดัะฐั ัะธะผัะปััะธั โ {balances[worst_idx]:,.2f}": worst_idx,
    }
    # ะัะต ัะธะผัะปััะธะธ ะฟะพ ะฝะพะผะตัะฐะผ
    for i in range(len(balances)):
        options[f"๐ ะกะธะผัะปััะธั #{i+1} โ {balances[i]:,.2f}"] = i

    # ะัะฑะพั ัะธะผัะปััะธะธ
    selected_label = st.selectbox("๐ **ะัะฑะตัะธัะต ัะธะผัะปััะธั ะดะปั ะฟัะพัะผะพััะฐ**", list(options.keys()))
    selected_index = options[selected_label]

    # ะะพัััะพะตะฝะธะต ัะฐะฑะปะธัั
    one_sim = data[selected_index]
    peak = one_sim[0]
    trades = []
    trades_raw = st.session_state.all_trades[selected_index]

    for i in range(1, len(one_sim)):
        pre_balance = one_sim[i - 1]
        post_balance = one_sim[i]
        pnl = post_balance - pre_balance
        peak = max(peak, post_balance)
        drawdown = (peak - post_balance) / peak if peak > 0 else 0

        trade_data = trades_raw[i - 1] 
        position_size = trade_data["position_size"]
        stop_loss_dollars = trade_data["sl"]
        take_profit_dollars = trade_data["tp"]

        trades.append({
            "โ": i,
            "๐ ะััะพะด": "โ Win" if pnl > 0 else "โ Loss",
            "๐ผ ะะพ ัะดะตะปะบะธ": f"{pre_balance:,.2f}",
            "๐ธ PnL": f"{pnl:+.2f}",
            "๐ ะะพัะปะต ัะดะตะปะบะธ": f"{post_balance:,.2f}",
            "๐ ะัะพัะฐะดะบะฐ": f"{drawdown:.0%}",
            "๐ ะะธะบ": f"{peak:,.2f}",
            "๐ฆ ะะฑััะผ ะฒัะพะดะฐ ($)": f"{position_size:,.2f}",
            "๐ SL ($)": f"{stop_loss_dollars:,.2f}",
            "๐ฏ TP ($)": f"{take_profit_dollars:,.2f}",
        })

    df_trades = pd.DataFrame(trades)

    # ะัะฒะพะด
    with st.expander(f"๐ _ะะพะบะฐะทะฐัั ัะฐะฑะปะธัั ัะฐะณะพะฒ ะฒัะฑัะฐะฝะฝะพะน ัะธะผัะปััะธะธ_"):
        st.markdown("""
    **๐ ะงัะพ ะฒะธะดะฝะพ ะฒ ัะฐะฑะปะธัะต:**
    - _**๐ข โ**_ โ ะฝะพะผะตั ัะดะตะปะบะธ ะฟะพ ะฟะพััะดะบั
    - _**๐ ะััะพะด**_ โ ะฟะพะฑะตะดะฐ โ ะธะปะธ ะฟะพัะฐะถะตะฝะธะต โ
    - _**๐ธ PnL ($)**_ โ ะฟัะธะฑัะปั ะธะปะธ ัะฑััะพะบ ะฒ ะดะพะปะปะฐัะฐั ะฟะพ ะบะฐะถะดะพะน ัะดะตะปะบะต
    - _**๐ผ ะะพ ัะดะตะปะบะธ / ๐ ะะพัะปะต ัะดะตะปะบะธ**_ โ ะฑะฐะปะฐะฝั ะดะพ ะธ ะฟะพัะปะต ะบะฐะถะดะพะน ัะดะตะปะบะธ
    - _**๐ ะัะพัะฐะดะบะฐ**_ โ ัะฝะธะถะตะฝะธะต ะพั ะผะฐะบัะธะผะฐะปัะฝะพะณะพ ะฑะฐะปะฐะฝัะฐ ะดะพ ัะตะบััะตะณะพ
    - _**๐ ะะธะบ**_ โ ัะฐะผัะน ะฒััะพะบะธะน ะฑะฐะปะฐะฝั, ะดะพััะธะณะฝัััะน ะบ ััะพะผั ะผะพะผะตะฝัั
    - _**๐ฆ ะะฑััะผ ะฒัะพะดะฐ ($)**_ โ ััะผะผะฐ, ะฝะฐ ะบะพัะพััั ะฑัะปะฐ ะพัะบัััะฐ ัะดะตะปะบะฐ  
    ๐ `ะฒัะพะด = ัะธัะบ ะฝะฐ ัะดะตะปะบั / ััะพะฟ % ร 100`
    - _**๐ SL ($)**_ โ ะฟะพัะตะฝัะธะฐะปัะฝัะน ัะฑััะพะบ ะฟัะธ ััะฐะฑะฐััะฒะฐะฝะธะธ ััะพะฟะฐ  
    ๐ `SL = ะฒัะพะด ร ััะพะฟ %`
    - _**๐ฏ TP ($)**_ โ ะฟัะธะฑัะปั ะฟัะธ ะดะพััะธะถะตะฝะธะธ ัะตะนะบ-ะฟัะพัะธัะฐ  
    ๐ `TP = SL ร RR`

    ๐ ะัะฟะพะปัะทัะนัะต ัะฐะฑะปะธัั ะดะปั ะฐะฝะฐะปะธะทะฐ ะฟะพะฒะตะดะตะฝะธั ัััะฐัะตะณะธะธ ะฝะฐ ะบะฐะถะดะพะผ ััะฐะฟะต!
    """)
        st.dataframe(df_trades, use_container_width=True)