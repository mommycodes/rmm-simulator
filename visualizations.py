import streamlit as st
import numpy as np
import matplotlib.pyplot as plt

def plot_simulations(data, initial_balance):
    st.markdown("#### üìà 100 —Å–∏–º—É–ª—è—Ü–∏–π –∫–∞–ø–∏—Ç–∞–ª–∞")
    st.caption("""
    –ö–∞–∂–¥–∞—è –ª–∏–Ω–∏—è ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å–∏–º—É–ª—è—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.  
    **–û—Å—å X** ‚Äî –Ω–æ–º–µ—Ä —Å–¥–µ–ª–∫–∏ (–≤—Ä–µ–º–µ–Ω–Ω–æ–π —à–∞–≥).  
    **–û—Å—å Y** ‚Äî —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å.  
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –≤–µ–¥—ë—Ç —Å–µ–±—è –∫–∞–ø–∏—Ç–∞–ª –ø–æ –º–µ—Ä–µ —Å–¥–µ–ª–æ–∫. –ù—É–∂–µ–Ω –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏–ª–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏.
    """)
    fig, ax = plt.subplots()
    for i in range(min(100, len(data))):
        ax.plot(data[i], alpha=0.5)
    ax.axhline(initial_balance, color='red', linestyle='--', label='–°—Ç–∞—Ä—Ç')
    ax.set_title("–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –∫–∞–ø–∏—Ç–∞–ª–∞ (100 —Å–∏–º—É–ª—è—Ü–∏–π)")
    ax.legend()
    st.pyplot(fig)

def plot_best_worst(data, balances):
    st.markdown("#### üü¢ 10 –ª—É—á—à–∏—Ö | üîª 10 —Ö—É–¥—à–∏—Ö")
    st.caption("""
    **–ó–µ–ª—ë–Ω—ã–µ –ª–∏–Ω–∏–∏** ‚Äî —Å–∏–º—É–ª—è—Ü–∏–∏ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∏—Ç–æ–≥–æ–º.  
    **–ö—Ä–∞—Å–Ω—ã–µ –ª–∏–Ω–∏–∏** ‚Äî —Å–∏–º—É–ª—è—Ü–∏–∏ —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º –∏—Ç–æ–≥–æ–º.  
    **–û—Å—å X** ‚Äî —à–∞–≥ (–Ω–æ–º–µ—Ä —Å–¥–µ–ª–∫–∏),  
    **–û—Å—å Y** ‚Äî —Ç–µ–∫—É—â–∏–π –∫–∞–ø–∏—Ç–∞–ª.  
    –≠—Ç–æ—Ç –≥—Ä–∞—Ñ–∏–∫ –ø–æ–º–æ–≥–∞–µ—Ç —Å—Ä–∞–≤–Ω–∏—Ç—å –∫—Ä–∞–π–Ω–∏–µ –∏—Å—Ö–æ–¥—ã –∏ –æ—Ü–µ–Ω–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞ –∏ –Ω–∞–≥—Ä–∞–¥—ã.
    """)
    fig, ax = plt.subplots()
    best = balances.argsort()[-10:]
    worst = balances.argsort()[:10]
    for i in worst:
        ax.plot(data[i], color='red', alpha=0.6)
    for i in best:
        ax.plot(data[i], color='green', alpha=0.6)
    ax.set_title("–õ—É—á—à–∏–µ –∏ —Ö—É–¥—à–∏–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –∫–∞–ø–∏—Ç–∞–ª–∞")
    st.pyplot(fig)

def plot_distribution(balances, initial_balance):
    st.markdown("#### üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –±–∞–ª–∞–Ω—Å–æ–≤")
    st.caption("""
    **–û—Å—å X** ‚Äî –∏—Ç–æ–≥–æ–≤—ã–π –∫–∞–ø–∏—Ç–∞–ª –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–∏–º—É–ª—è—Ü–∏–∏.  
    **–û—Å—å Y** ‚Äî —Å–∫–æ–ª—å–∫–æ —Å–∏–º—É–ª—è—Ü–∏–π –¥–∞–ª–∏ —Ç–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.  
    –≠—Ç–æ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∞—è —á–∞—Å—Ç–æ—Ç—É —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Ç–æ–≥–æ–≤. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ã–ª–∏ —Å–∞–º—ã–º–∏ —Ç–∏–ø–∏—á–Ω—ã–º–∏.
    """)
    fig, ax = plt.subplots()
    ax.hist(balances, bins=50, color='skyblue', edgecolor='black')
    ax.axvline(initial_balance, color='red', linestyle='--', label='–°—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å')
    ax.set_title("–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –∏—Ç–æ–≥–æ–≤ –ø–æ —Å–∏–º—É–ª—è—Ü–∏—è–º")
    ax.legend()
    st.pyplot(fig)

def plot_liquidation_distribution(liq_steps, num_trades):
    st.markdown("#### üíÄ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–π –ø–æ —Å–¥–µ–ª–∫–∞–º")
    st.caption("""
    **–û—Å—å X** ‚Äî –Ω–æ–º–µ—Ä —Å–¥–µ–ª–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–æ–∏–∑–æ—à–ª–∞ –ª–∏–∫–≤–∏–¥–∞—Ü–∏—è.  
    **–û—Å—å Y** ‚Äî —Å–∫–æ–ª—å–∫–æ —Å–∏–º—É–ª—è—Ü–∏–π –±—ã–ª–∏ –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —ç—Ç–æ–º —à–∞–≥–µ.  
    –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å, –≤ –∫–∞–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞–∏–±–æ–ª–µ–µ —É—è–∑–≤–∏–º–∞ –∏ –∫–æ–≥–¥–∞ —á–∞—â–µ –≤—Å–µ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –æ–±–Ω—É–ª–µ–Ω–∏—è.
    """)
    fig, ax = plt.subplots()
    ax.hist(liq_steps, bins=num_trades, edgecolor='black')
    ax.set_title("–®–∞–≥–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∏ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏")
    st.pyplot(fig)

def plot_probability_heatmap(data, initial_balance):
    st.markdown("#### üß† –ö–∞—Ä—Ç–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π (–Ω–∏–∂–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞)")
    st.caption("""
    **–û—Å—å X** ‚Äî –Ω–æ–º–µ—Ä —Å–¥–µ–ª–∫–∏ (—à–∞–≥ —Å–∏–º—É–ª—è—Ü–∏–∏).  
    **–û—Å—å Y** ‚Äî –¥–æ–ª—è —Å–∏–º—É–ª—è—Ü–∏–π, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –±–∞–ª–∞–Ω—Å –æ–ø—É—Å—Ç–∏–ª—Å—è –Ω–∏–∂–µ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ.  
    –≠—Ç–æ—Ç –≥—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–π –≤—Ö–æ–¥—è—Ç –≤ –ø—Ä–æ—Å–∞–¥–∫—É. –ü–æ–ª–µ–∑–µ–Ω –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–∑–∞—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
    """)
    heat = [np.sum(data[:, j] < initial_balance) / len(data) for j in range(1, data.shape[1])]
    fig, ax = plt.subplots()
    ax.plot(range(1, len(heat)+1), heat)
    ax.set_ylim(0, 1)
    ax.set_xlabel("–®–∞–≥ —Å–¥–µ–ª–∫–∏")
    ax.set_ylabel("–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å < —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞")
    ax.set_title("–î–æ–ª—è –ø—Ä–æ—Å–µ–≤—à–∏—Ö —Å–∏–º—É–ª—è—Ü–∏–π –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ")
    st.pyplot(fig)
